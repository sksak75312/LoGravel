---
title: 'React ç‹€æ…‹ç®¡ç†å®Œæ•´æŒ‡å—ï¼šå¾ useState åˆ° Context API'
description: 'æ·±å…¥æ¢è¨ React ä¸­çš„ç‹€æ…‹ç®¡ç†æŠ€è¡“ï¼ŒåŒ…å« useStateã€useReducerã€Context API ä»¥åŠç‹€æ…‹æå‡ç­‰æ ¸å¿ƒæ¦‚å¿µï¼Œä¸¦æä¾›å¯¦ç”¨çš„æœ€ä½³å¯¦è¸å»ºè­°ã€‚'
date: '2025-06-04'
keywords: ['React', 'ç‹€æ…‹ç®¡ç†', 'useState', 'useReducer', 'Context API', 'Hooks']
openGraph: '/react.png'
slug: 'react-state-management-guide'
category: 'React'
---

# React ç‹€æ…‹ç®¡ç†å®Œæ•´æŒ‡å—ï¼šå¾ useState åˆ° Context API

ç‹€æ…‹ç®¡ç†æ˜¯ React é–‹ç™¼ä¸­æœ€é‡è¦çš„æ ¸å¿ƒæ¦‚å¿µä¹‹ä¸€ã€‚ç„¡è«–æ˜¯ç°¡å–®çš„è¨ˆæ•¸å™¨é‚„æ˜¯è¤‡é›œçš„ä¼æ¥­ç´šæ‡‰ç”¨ï¼ŒæŒæ¡æ­£ç¢ºçš„ç‹€æ…‹ç®¡ç†æŠ€è¡“éƒ½æ˜¯æˆåŠŸçš„é—œéµã€‚é€™ç¯‡æ–‡ç« å°‡å¸¶ä½ å¾åŸºç¤çš„ `useState` é–‹å§‹ï¼Œé€æ­¥æ·±å…¥åˆ° Context API å’Œè‡ªè¨‚ Hook çš„é€²éšæ‡‰ç”¨ã€‚

---

## ğŸ“Œ åŸºç¤ç¯‡ï¼šuseState çš„åŸºæœ¬ä½¿ç”¨

`useState` æ˜¯æœ€å¸¸ç”¨çš„ Hookï¼Œç”¨æ–¼åœ¨å‡½å¼å…ƒä»¶ä¸­ç®¡ç†å€åŸŸç‹€æ…‹ã€‚

```jsx
import { useState } from 'react';

function Counter() {
  const [count, setCount] = useState(0);

  return (
    <div>
      <p>ç›®å‰è¨ˆæ•¸ï¼š{count}</p>
      <button onClick={() => setCount(count + 1)}>å¢åŠ </button>
      <button onClick={() => setCount(count - 1)}>æ¸›å°‘</button>
      <button onClick={() => setCount(0)}>é‡ç½®</button>
    </div>
  );
}
```

### é‡è¦æ¦‚å¿µï¼š

- **ç‹€æ…‹ä¸å¯è®Šæ€§**ï¼šæ°¸é ä¸è¦ç›´æ¥ä¿®æ”¹ç‹€æ…‹ï¼Œè€Œæ˜¯ä½¿ç”¨ setter å‡½å¼
- **æ‰¹æ¬¡æ›´æ–°**ï¼šReact æœƒè‡ªå‹•å°‡å¤šå€‹ç‹€æ…‹æ›´æ–°æ‰¹æ¬¡è™•ç†ä»¥æå‡æ•ˆèƒ½
- **å‡½å¼å¼æ›´æ–°**ï¼šç•¶æ–°ç‹€æ…‹ä¾è³´æ–¼å‰ä¸€å€‹ç‹€æ…‹æ™‚ï¼Œä½¿ç”¨å‡½å¼å½¢å¼

```jsx
// âŒ éŒ¯èª¤ï¼šç›´æ¥ä¿®æ”¹ç‹€æ…‹
count++;

// âœ… æ­£ç¢ºï¼šä½¿ç”¨ setter å‡½å¼
setCount(count + 1);

// âœ… æ›´å¥½ï¼šä½¿ç”¨å‡½å¼å¼æ›´æ–°
setCount(prevCount => prevCount + 1);
```

---

## ğŸ”§ é€²éšç¯‡ï¼šè™•ç†è¤‡é›œç‹€æ…‹

ç•¶ç‹€æ…‹è®Šå¾—è¤‡é›œæ™‚ï¼Œä½¿ç”¨ç‰©ä»¶æˆ–é™£åˆ—ä¾†ç®¡ç†ç‹€æ…‹æ˜¯å¸¸è¦‹çš„åšæ³•ã€‚

```jsx
import { useState } from 'react';

function UserProfile() {
  const [user, setUser] = useState({
    name: '',
    email: '',
    age: 0,
    preferences: {
      theme: 'light',
      notifications: true
    }
  });

  const updateUserField = (field, value) => {
    setUser(prevUser => ({
      ...prevUser,
      [field]: value
    }));
  };

  const updatePreferences = (prefKey, value) => {
    setUser(prevUser => ({
      ...prevUser,
      preferences: {
        ...prevUser.preferences,
        [prefKey]: value
      }
    }));
  };

  return (
    <div>
      <input
        type="text"
        placeholder="å§“å"
        value={user.name}
        onChange={(e) => updateUserField('name', e.target.value)}
      />
      <input
        type="email"
        placeholder="ä¿¡ç®±"
        value={user.email}
        onChange={(e) => updateUserField('email', e.target.value)}
      />
      <input
        type="number"
        placeholder="å¹´é½¡"
        value={user.age}
        onChange={(e) => updateUserField('age', parseInt(e.target.value))}
      />
      
      <label>
        <input
          type="checkbox"
          checked={user.preferences.notifications}
          onChange={(e) => updatePreferences('notifications', e.target.checked)}
        />
        æ¥æ”¶é€šçŸ¥
      </label>
    </div>
  );
}
```

---

## âš¡ useReducerï¼šç®¡ç†è¤‡é›œé‚è¼¯

ç•¶ç‹€æ…‹é‚è¼¯è®Šå¾—è¤‡é›œæ™‚ï¼Œ`useReducer` æä¾›äº†æ›´å¥½çš„ç®¡ç†æ–¹å¼ã€‚

```jsx
import { useReducer } from 'react';

// å®šç¾© action types
const ACTIONS = {
  INCREMENT: 'increment',
  DECREMENT: 'decrement',
  RESET: 'reset',
  SET_VALUE: 'set_value'
};

// Reducer å‡½å¼
function counterReducer(state, action) {
  switch (action.type) {
    case ACTIONS.INCREMENT:
      return { count: state.count + 1 };
    case ACTIONS.DECREMENT:
      return { count: state.count - 1 };
    case ACTIONS.RESET:
      return { count: 0 };
    case ACTIONS.SET_VALUE:
      return { count: action.payload };
    default:
      throw new Error(`æœªçŸ¥çš„ action type: ${action.type}`);
  }
}

function AdvancedCounter() {
  const [state, dispatch] = useReducer(counterReducer, { count: 0 });

  return (
    <div>
      <p>è¨ˆæ•¸ï¼š{state.count}</p>
      <button onClick={() => dispatch({ type: ACTIONS.INCREMENT })}>
        +1
      </button>
      <button onClick={() => dispatch({ type: ACTIONS.DECREMENT })}>
        -1
      </button>
      <button onClick={() => dispatch({ type: ACTIONS.RESET })}>
        é‡ç½®
      </button>
      <button onClick={() => dispatch({ type: ACTIONS.SET_VALUE, payload: 10 })}>
        è¨­ç‚º 10
      </button>
    </div>
  );
}
```

---

## ğŸŒ Context APIï¼šè·¨å…ƒä»¶ç‹€æ…‹å…±äº«

ç•¶å¤šå€‹å…ƒä»¶éœ€è¦å…±äº«ç‹€æ…‹æ™‚ï¼ŒContext API æ˜¯ç†æƒ³çš„è§£æ±ºæ–¹æ¡ˆã€‚

```jsx
import { createContext, useContext, useReducer } from 'react';

// å»ºç«‹ Context
const ThemeContext = createContext();

// Theme Reducer
function themeReducer(state, action) {
  switch (action.type) {
    case 'TOGGLE_THEME':
      return {
        ...state,
        theme: state.theme === 'light' ? 'dark' : 'light'
      };
    case 'SET_LANGUAGE':
      return {
        ...state,
        language: action.payload
      };
    default:
      return state;
  }
}

// Context Provider
export function ThemeProvider({ children }) {
  const [state, dispatch] = useReducer(themeReducer, {
    theme: 'light',
    language: 'zh-TW'
  });

  const value = {
    ...state,
    toggleTheme: () => dispatch({ type: 'TOGGLE_THEME' }),
    setLanguage: (lang) => dispatch({ type: 'SET_LANGUAGE', payload: lang })
  };

  return (
    <ThemeContext.Provider value={value}>
      {children}
    </ThemeContext.Provider>
  );
}

// è‡ªè¨‚ Hook
export function useTheme() {
  const context = useContext(ThemeContext);
  if (!context) {
    throw new Error('useTheme å¿…é ˆåœ¨ ThemeProvider å…§ä½¿ç”¨');
  }
  return context;
}

// ä½¿ç”¨ç¯„ä¾‹
function Header() {
  const { theme, toggleTheme } = useTheme();
  
  return (
    <header style={{ backgroundColor: theme === 'light' ? '#fff' : '#333' }}>
      <h1>æˆ‘çš„æ‡‰ç”¨</h1>
      <button onClick={toggleTheme}>
        åˆ‡æ›åˆ° {theme === 'light' ? 'æ·±è‰²' : 'æ·ºè‰²'} ä¸»é¡Œ
      </button>
    </header>
  );
}
```

---

## ğŸ¯ è‡ªè¨‚ Hookï¼šå°è£ç‹€æ…‹é‚è¼¯

è‡ªè¨‚ Hook è®“ä½ èƒ½å¤ é‡è¤‡ä½¿ç”¨ç‹€æ…‹é‚è¼¯ã€‚

```jsx
import { useState, useEffect } from 'react';

// è‡ªè¨‚ Hookï¼šç®¡ç†æœ¬åœ°å„²å­˜
function useLocalStorage(key, initialValue) {
  const [storedValue, setStoredValue] = useState(() => {
    try {
      const item = window.localStorage.getItem(key);
      return item ? JSON.parse(item) : initialValue;
    } catch (error) {
      console.error('è®€å– localStorage éŒ¯èª¤:', error);
      return initialValue;
    }
  });

  const setValue = (value) => {
    try {
      setStoredValue(value);
      window.localStorage.setItem(key, JSON.stringify(value));
    } catch (error) {
      console.error('å¯«å…¥ localStorage éŒ¯èª¤:', error);
    }
  };

  return [storedValue, setValue];
}

// ä½¿ç”¨è‡ªè¨‚ Hook
function Settings() {
  const [settings, setSettings] = useLocalStorage('userSettings', {
    theme: 'light',
    notifications: true
  });

  const updateSetting = (key, value) => {
    setSettings(prev => ({
      ...prev,
      [key]: value
    }));
  };

  return (
    <div>
      <h2>è¨­å®š</h2>
      <label>
        ä¸»é¡Œï¼š
        <select 
          value={settings.theme}
          onChange={(e) => updateSetting('theme', e.target.value)}
        >
          <option value="light">æ·ºè‰²</option>
          <option value="dark">æ·±è‰²</option>
        </select>
      </label>
      
      <label>
        <input
          type="checkbox"
          checked={settings.notifications}
          onChange={(e) => updateSetting('notifications', e.target.checked)}
        />
        å•Ÿç”¨é€šçŸ¥
      </label>
    </div>
  );
}
```

---

## ğŸ“‹ ç‹€æ…‹æå‡ï¼šå…±äº«ç‹€æ…‹çš„æœ€ä½³å¯¦è¸

ç•¶å­å…ƒä»¶éœ€è¦å…±äº«ç‹€æ…‹æ™‚ï¼Œå°‡ç‹€æ…‹æå‡åˆ°å®ƒå€‘çš„å…±åŒçˆ¶å…ƒä»¶ã€‚

```jsx
import { useState } from 'react';

function ShoppingApp() {
  const [cart, setCart] = useState([]);
  const [products] = useState([
    { id: 1, name: 'iPhone', price: 30000 },
    { id: 2, name: 'MacBook', price: 50000 },
    { id: 3, name: 'iPad', price: 20000 }
  ]);

  const addToCart = (product) => {
    setCart(prevCart => {
      const existingItem = prevCart.find(item => item.id === product.id);
      if (existingItem) {
        return prevCart.map(item =>
          item.id === product.id
            ? { ...item, quantity: item.quantity + 1 }
            : item
        );
      }
      return [...prevCart, { ...product, quantity: 1 }];
    });
  };

  const removeFromCart = (productId) => {
    setCart(prevCart => prevCart.filter(item => item.id !== productId));
  };

  return (
    <div>
      <ProductList products={products} onAddToCart={addToCart} />
      <Cart items={cart} onRemoveFromCart={removeFromCart} />
    </div>
  );
}

function ProductList({ products, onAddToCart }) {
  return (
    <div>
      <h2>å•†å“åˆ—è¡¨</h2>
      {products.map(product => (
        <div key={product.id}>
          <h3>{product.name}</h3>
          <p>åƒ¹æ ¼ï¼š${product.price}</p>
          <button onClick={() => onAddToCart(product)}>
            åŠ å…¥è³¼ç‰©è»Š
          </button>
        </div>
      ))}
    </div>
  );
}

function Cart({ items, onRemoveFromCart }) {
  const total = items.reduce((sum, item) => sum + item.price * item.quantity, 0);

  return (
    <div>
      <h2>è³¼ç‰©è»Š</h2>
      {items.length === 0 ? (
        <p>è³¼ç‰©è»Šæ˜¯ç©ºçš„</p>
      ) : (
        <>
          {items.map(item => (
            <div key={item.id}>
              <span>{item.name} x {item.quantity}</span>
              <button onClick={() => onRemoveFromCart(item.id)}>
                ç§»é™¤
              </button>
            </div>
          ))}
          <p><strong>ç¸½è¨ˆï¼š${total}</strong></p>
        </>
      )}
    </div>
  );
}
```

---

## ğŸ’¡ æœ€ä½³å¯¦è¸èˆ‡å¸¸è¦‹é™·é˜±

### æœ€ä½³å¯¦è¸

1. **ä¿æŒç‹€æ…‹çµæ§‹ç°¡å–®**ï¼šé¿å…éåº¦å·¢ç‹€çš„ç‰©ä»¶çµæ§‹
2. **ä½¿ç”¨ useCallback å’Œ useMemo**ï¼šé¿å…ä¸å¿…è¦çš„é‡æ–°æ¸²æŸ“
3. **ç‹€æ…‹æ­¸ä¸€åŒ–**ï¼šå°‡è¤‡é›œè³‡æ–™çµæ§‹æ­£è¦åŒ–
4. **å–®ä¸€è·è²¬åŸå‰‡**ï¼šæ¯å€‹ç‹€æ…‹æ‡‰è©²æœ‰æ˜ç¢ºçš„ç”¨é€”

### å¸¸è¦‹é™·é˜±

```jsx
// âŒ é™·é˜± 1ï¼šç›´æ¥ä¿®æ”¹ç‹€æ…‹
const [items, setItems] = useState([1, 2, 3]);
items.push(4); // éŒ¯èª¤ï¼

// âœ… æ­£ç¢ºåšæ³•
setItems(prev => [...prev, 4]);

// âŒ é™·é˜± 2ï¼šåœ¨ useEffect ä¸­å¿˜è¨˜ä¾è³´
useEffect(() => {
  fetchData(userId);
}, []); // ç¼ºå°‘ userId ä¾è³´

// âœ… æ­£ç¢ºåšæ³•
useEffect(() => {
  fetchData(userId);
}, [userId]);

// âŒ é™·é˜± 3ï¼šéåº¦ä½¿ç”¨ Context
// ä¸è¦ç‚ºæ¯å€‹å°ç‹€æ…‹éƒ½å»ºç«‹ Context

// âœ… æ­£ç¢ºåšæ³•ï¼šåªç‚ºçœŸæ­£éœ€è¦å…¨åŸŸå…±äº«çš„ç‹€æ…‹ä½¿ç”¨ Context
```

---

## ğŸš€ ç¸½çµ

React ç‹€æ…‹ç®¡ç†çš„é¸æ“‡å–æ±ºæ–¼ä½ çš„æ‡‰ç”¨è¤‡é›œåº¦ï¼š

- **ç°¡å–®ç‹€æ…‹**ï¼šä½¿ç”¨ `useState`
- **è¤‡é›œé‚è¼¯**ï¼šä½¿ç”¨ `useReducer`
- **è·¨å…ƒä»¶å…±äº«**ï¼šä½¿ç”¨ Context API
- **é‡è¤‡é‚è¼¯**ï¼šå»ºç«‹è‡ªè¨‚ Hook
- **å¤§å‹æ‡‰ç”¨**ï¼šè€ƒæ…®ç¬¬ä¸‰æ–¹ç‹€æ…‹ç®¡ç†åº«å¦‚ Reduxã€Zustand

æŒæ¡é€™äº›åŸºç¤æ¦‚å¿µå¾Œï¼Œä½ å°±èƒ½æ ¹æ“šå°ˆæ¡ˆéœ€æ±‚é¸æ“‡æœ€é©åˆçš„ç‹€æ…‹ç®¡ç†æ–¹æ¡ˆï¼Œä¸¦å¯«å‡ºæ›´ç¶­è­·æ€§æ›´é«˜çš„ React æ‡‰ç”¨ã€‚

è¨˜ä½ï¼Œå¥½çš„ç‹€æ…‹ç®¡ç†ä¸åƒ…åƒ…æ˜¯æŠ€è¡“å•é¡Œï¼Œæ›´æ˜¯è¨­è¨ˆå•é¡Œã€‚èŠ±æ™‚é–“æ€è€ƒä½ çš„ç‹€æ…‹çµæ§‹ï¼Œæœƒè®“ä½ çš„ç¨‹å¼ç¢¼æ›´æ¸…æ™°ã€æ›´å®¹æ˜“ç¶­è­·ã€‚